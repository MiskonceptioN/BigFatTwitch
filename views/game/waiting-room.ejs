<%- include('../header'); %>
<% 
const teamMate = findTeammate(game, user);

function findTeammate(game, currentUser) {
	let teamMate = "";
		for (let i = 0; i < game.teams.length; i++) {
		const playerOne = game.teams[i].players[0];
		const playerTwo = game.teams[i].players[1];

		if (currentUser.twitchId === playerOne.twitchId || currentUser.twitchId === playerTwo.twitchId) {
			teamMate = (playerOne.twitchId === currentUser.twitchId) ? playerTwo : playerOne;
		}
	}
	return teamMate;
}

%>
    <section id="game" class="text-center">
        <header>
            <h1>Waiting for game to begin</h1>
        </header>
		<% if (failureMessage) { %>
			<div class="container">
				<section>
					<div class="alert alert-danger" role="alert"><%= failureMessage %></div>
				</section>
			</div>
		<% } if (successMessage) { %>
			<div class="container">
				<section>
					<div class="alert alert-success" role="alert"><%= successMessage %></div>
				</section>
			</div>
		<% } %>
		<section>
			<h2><span class="live-players">1</span> of 6 players ready</h2>
		</section>
		<hr>
		<section>
			<h2>Your teammate is:</h2>
			<div class="row">
				<div class="col">
					<figure>
						<img id="<%- teamMate.displayName %>-thumbnail"
						class="player-icon <% if (teamMate.inGame === game.code) { %>player-logged-in<% } else { %>player-logged-out<% } %>" src="<%- teamMate.profileImageUrl %>" width="100" alt="<%- teamMate.displayName %>'s thumbnail">
						
						<figcaption><%- teamMate.displayName %></figcaption>
					</figure>
				</div>
			</div>
		</section>
		<hr>
		<section>
			<h2>Team chat:</h2>
			<div class="row">
				<input type="text">
				<input type="submit" value="Send">
			</div>
			<div class="row">
				<ul id="messages">
					<li>dannyvalz (21:12): You ready?</li>
					<li>AlexStarbelle (21:13): You betcha!</li>
				</ul>
			</div>
		</section>
		<footer style="margin-top: 10em;">
            <h6>Made by <a href="https://www.twitch.tv/dannyvalz" target="_blank">Danny Valentine <img width="16" height="16" src="https://twitch.tv/favicon.ico"></a></h6>
        </footer>
    </section>
	<script src="/socket.io/socket.io.js"></script>
	<script>
	const socket = io();

	socket.on('chat message', (msg) => {
		const item = document.createElement('li');
		item.innerHTML = msg;
		document.querySelector("h2").appendChild(item);
		window.scrollTo(0, document.body.scrollHeight);
	});

	</script>
	<!-- <script src="js/ajaxFormHandler.js"></script> -->
<%- include('../footer'); %>