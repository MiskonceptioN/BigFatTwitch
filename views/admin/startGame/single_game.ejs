<%- include('../../header'); %>
	<section id="game-management" class="text-center">
		<header>
			<h1>Game: <%- game.code %></h1>
		</header>
		<% if(user.role == "admin"){ %>
			<% if (failureMessage) { %>
				<div class="container">
					<section>
						<div class="alert alert-danger" role="alert"><%= failureMessage %></div>
					</section>
				</div>
			<% } if (successMessage) { %>
				<div class="container">
					<section>
						<div class="alert alert-success" role="alert"><%= successMessage %></div>
					</section>
				</div>
			<% } %>

			<div class="row">
				
					<% game.teams.forEach(function(team) { %>
					<div class="col">
						<div class="row">
							<h2><%- team.name %></h2>
						<% team.players.forEach(function(player) { %>
							<div class="col">
								<figure>
									<img id="<%- player.displayName %>-thumbnail" 
									class="player-icon <% if (player.inGame === game.code) { %>player-logged-in<% } else { %>player-logged-out<% } %>" src="<%- player.profileImageUrl %>" width="100" alt="<%- player.displayName %>'s thumbnail">
									<figcaption><%- player.displayName %></figcaption>
								</figure>
							</div>
						<% }) %>
						</div>
					</div>
					<% }) %>
				
			</div>
			<div class="row mt-3">
				<button class="btn btn-large btn-twitch btn-block">START GAME!</button>
			</div>
			<section>
				<h2>Audits</h2>
				<div class="row">
					<% game.teams.forEach(function(team) { %>
						<h3 class="mt-3"><%- team.name %>'s chat</h3>
						<textarea readonly disabled>
Player one (19:53): Lorem ipsum dolor sit amet consectetur adipisicing elit. Quas ducimus dicta asperiores deleniti explicabo vel eum assumenda, suscipit tenetur hic? Maiores sit reiciendis voluptate numquam tempore quasi, dolor quia beatae.
Player two (19:54); U wot m8?</textarea>
					<% }); %>
				</div>
			</section>
			<% } else { %>
			<h1 class="text-danger">You should not be here!</h1>
		<% } %>
	</section>
	<script src="/socket.io/socket.io.js"></script>
	<script>
	// Scroll all team chats to bottom
	$('textarea').each(function() {
		$(this).scrollTop($(this)[0].scrollHeight);
	});

	const socket = io();

	socket.on('player joined', (gameCode, user) => {
		if (gameCode === "<%- game.code %>") {
			const playerIcon = document.getElementById(user.displayName + "-thumbnail");
			const teamContainer = playerIcon.parentElement.parentElement;
			playerIcon.classList.remove("player-logged-out");
			playerIcon.classList.add("player-logged-in");

			// socket.emit('player joined', gameCode, user);

			// // Use jquery to say "if both img inside col have class player-logged-in, then add class team-ready"
			// if ($(teamContainer).children(".player-logged-in").length == 2) {
			// 	$(teamContainer).addClass("team-ready");
			// }
		}
		// const item = document.createElement('li');
		// item.innerHTML = msg;
		// messages.appendChild(item);
		// window.scrollTo(0, document.body.scrollHeight);
	});
	// socket.on('player disconnected', (gameCode, user) => {
	// 	if (gameCode === "<%- game.code %>") {
	// 		const playerIcon = document.getElementById(user.displayName + "-thumbnail");
	// 		const teamContainer = playerIcon.parentElement.parentElement;
	// 		playerIcon.classList.add("player-logged-out");
	// 		playerIcon.classList.remove("player-logged-in");

	// 		socket.emit('player disconnected', gameCode, user);

			// // Use jquery to say "if both img inside col have class player-logged-in, then add class team-ready"
			// if ($(teamContainer).children(".player-logged-in").length == 2) {
			// 	$(teamContainer).addClass("team-ready");
			// }
		// }
		// const item = document.createElement('li');
		// item.innerHTML = msg;
		// messages.appendChild(item);
		// window.scrollTo(0, document.body.scrollHeight);
	// });
	</script>
	<script src="/js/gameTableFormHandler.js"></script>
<%- include('../../footer'); %>


